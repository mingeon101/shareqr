<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File QR share</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="/favicon.png">
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">

    <div class="bg-white p-8 rounded-3xl shadow-xl w-full max-w-sm text-center">
        <h2 class="text-xl font-bold mb-6 text-gray-800"></h2>
        
        <div class="mb-6">
            <input type="file" id="fileInput" class="hidden" onchange="document.getElementById('fileLabel').innerText = this.files[0].name">
            <label for="fileInput" id="fileLabel" class="flex items-center justify-center w-full h-32 border-2 border-dashed border-gray-200 rounded-xl cursor-pointer bg-gray-50 hover:bg-gray-100 text-gray-400 text-sm p-4 break-all">
                여기를 눌러 파일을 선택하세요
            </label>
        </div>

        <button onclick="uploadToPixeldrain()" id="btn" class="w-full bg-black text-white py-4 rounded-xl font-bold hover:bg-gray-800 transition shadow-lg border-b-4 border-gray-600 active:border-b-0 active:translate-y-1">
            업로드 및 QR 생성
        </button>

        <div id="loader" class="hidden mt-6 animate-pulse text-sm text-gray-500 font-bold">
            링크 생성 중...
        </div>

        <div id="result" class="mt-8 hidden overflow-hidden">
            <div class="p-2 bg-white rounded-lg inline-block border-4 border-gray-800">
                <img id="qrImage" src="" alt="QR Code" class="w-48 h-48 block">
            </div>
            <p class="mt-4 text-[10px] text-gray-400 font-mono" id="linkText"></p>
            <p class="mt-2 text-xs text-red-500 font-bold">↑ 스캔 시 즉시 다운로드 시작</p>
        </div>
    </div>

    <script>
        async function uploadToPixeldrain() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            const btn = document.getElementById('btn');
            const loader = document.getElementById('loader');
            const result = document.getElementById('result');
            const qrImage = document.getElementById('qrImage');
            const linkText = document.getElementById('linkText');

            if (!file) return alert('파일을 선택해 주세요!');

            btn.classList.add('hidden');
            loader.classList.remove('hidden');
            result.classList.add('hidden');

            const formData = new FormData();
            formData.append('file', file);

            try {
                const response = await fetch('https://pixeldrain.com/api/file', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    const fileId = data.id;
                    const directDownloadUrl = `https://pixeldrain.com/api/file/${fileId}`;
                    
                    const qrApiUrl = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(directDownloadUrl)}`;
                    
                    qrImage.src = qrApiUrl;
                    linkText.innerText = directDownloadUrl;
                    
                    loader.classList.add('hidden');
                    result.classList.remove('hidden');
                } else {
                    throw new Error('Upload failed');
                }
            } catch (err) {
                console.error(err);
                alert('업로드 실패! 다른 파일을 시도하거나 잠시 후 다시 해주세요.');
                btn.classList.remove('hidden');
                loader.classList.add('hidden');
            }
        }
    </script>
</body>
</html>
